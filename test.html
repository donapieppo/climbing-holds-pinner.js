<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=yes">

    <title>I blocchi e i giri di Eden</title>
    <meta content="Pagina con i blocchi e i giri" name="description" />
    
    <script type="module" src="./index.js"></script>
    <script src="https://unpkg.com/konva@3.1.0/konva.js"></script>

    <style>
      .action_button {
        width: 100px;
        padding: 5px;
        margin: 3px;
      }
      .selected {
        background-color: green;
      }
    </style>
  </head>

  <body>
    <h1>CIAO</h1>
    <div style="position: fixed; top: 10px; left: 0; z-index: 1000; background-color: rgba(120,120,120,0.2)">
      <button id="start_hold_btn" class="selected action_button">Start</button> <br/>
      <button id="top_hold_btn" class="action_button">Top</button> <br/>
      <button id="increase_hold_size_btn" class="action_button">+</button> <br/>
      <button id="decrease_hold_size_btn" class="action_button">-</button> <br/>
      <button id="undo_btn" class="action_button">UNDO</button>
    </div>
    <div id="canvasDiv" style="width: 1024px; heigh: 1024px; background-image: url('./test.png'); background-size: contain"></div>
    <script type="module">
      import HoldsPinner from "./index.js";
      const holds_pinner = new HoldsPinner({target: 'canvasDiv', width: 1024, height: 1024, editable: true});
      console.log(holds_pinner);

      document.querySelector('#start_hold_btn').addEventListener('click', toggle_start_hold)
      document.querySelector('#top_hold_btn').addEventListener('click', toggle_top_hold)
      document.querySelector('#increase_hold_size_btn').addEventListener('click', increase_hold_size)
      document.querySelector('#decrease_hold_size_btn').addEventListener('click', decrease_hold_size)
      document.querySelector('#undo_btn').addEventListener('click', undo)

      function clear_selected() {
        document.querySelector('#start_hold_btn').classList.remove("selected");
          document.querySelector('#top_hold_btn').classList.remove("selected");
      }

      function toggle_start_hold() {
        clear_selected()
        if (holds_pinner.get_hold_type() === 'start') {
          holds_pinner.change_hold_type('hold')
        } else {
          document.querySelector('#start_hold_btn').classList.add("selected");
          holds_pinner.change_hold_type('start')
        }
      }

      function toggle_top_hold() {
        clear_selected()
        if (holds_pinner.get_hold_type() === 'top') {
          holds_pinner.change_hold_type('hold')
        } else {
          document.querySelector('#top_hold_btn').classList.add("selected");
          holds_pinner.change_hold_type('top')
        }
      }

      function increase_hold_size() {
        holds_pinner.increase_size();
      }

      function decrease_hold_size() {
        holds_pinner.decrease_size();
      }

      function undo() {
        holds_pinner.undo();
      }


      //const startingHolds = {};<%= raw (@game.pinnings ? @game.pinnings.to_json : []) %>;
      //holds_pinner.setup(startingHolds);
      // wait for bootstrap resize 
      //window.addEventListener('load', function () {
      //  holds_pinner.fitStageIntoParentContainer();
      //}, false);
    </script>
  </body>
</html>

