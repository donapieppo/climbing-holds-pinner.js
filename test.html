<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=yes">

    <title>I blocchi e i giri di Eden</title>
    <meta content="Pagina con i blocchi e i giri" name="description" />
    
    <script src="https://unpkg.com/konva@4.0.0/konva.js"></script>
    <script type="module" src="./index.js"></script>

    <style>
.pinning-action-button {
  width: 70px;
  padding: 5px 3px;
  margin: 3px;
  display: block;
}
.pinning-selected-button {
  background-color: green;
}
    </style>
  </head>

  <body>
    <h1>CIAO</h1>
    <div style="position: fixed !important; top: 10px; left: 0; z-index: 1000;">
      <button id="start_hold_btn"         class="pinning-selected-button pinning-action-button">Start</button> 
      <button id="top_hold_btn"           class="pinning-action-button">Top</button> 
      <button id="increase_hold_size_btn" class="pinning-action-button mt-2"><i class="fas fa-plus"></i>+</button> 
      <button id="decrease_hold_size_btn" class="pinning-action-button"><i class="fas fa-minus"></i>-</button> 
      <button id="undo_btn"               class="pinning-action-button"><i class="fas fa-undo"></i>undo</button>
      <button id="save"                   class="pinning-action-button mt-2">Salva</button>
    </div>
    <div id="canvasDiv" style="margin: 60px auto; width: 1024px; height: 1024px; background-image: url('test.png')"></div>

<script type="module">
   import HoldsPinner from "./index.js";
   const holds_pinner = new HoldsPinner({editable: true, size_ratio: 50, numerable: true});
   const startingHolds = []
   console.log('startingHolds')
   console.log(startingHolds)

   // holds_pinner.setup([{"c":"HoldLabel","x":200,"y":100,"type":"start","size":40}]);
   holds_pinner.setup([{"c":"Hold","x":200,"y":100,"type":"top","size":40},
                       {"c":"HoldLabel","x":200,"y":200,"type":"top","size":40}]);

   document.querySelector('#start_hold_btn').addEventListener('click', toggle_start_hold)
   document.querySelector('#top_hold_btn').addEventListener('click', toggle_top_hold)
   document.querySelector('#increase_hold_size_btn').addEventListener('click', increase_hold_size)
   document.querySelector('#decrease_hold_size_btn').addEventListener('click', decrease_hold_size)
   document.querySelector('#undo_btn').addEventListener('click', undo)
   document.querySelector('#save').addEventListener('click', save_holds)

   function clear_selected() {
     document.querySelector('#start_hold_btn').classList.remove("pinning-selected-button");
     document.querySelector('#top_hold_btn').classList.remove("pinning-selected-button");
   }

   function toggle_start_hold() {
     clear_selected()
     if (holds_pinner.get_hold_type() === 'start') {
       holds_pinner.change_hold_type('hold')
     } else {
       document.querySelector('#start_hold_btn').classList.add("pinning-selected-button");
       holds_pinner.change_hold_type('start')
     }
   }

   function toggle_top_hold() {
     clear_selected()
     if (holds_pinner.get_hold_type() === 'top') {
       holds_pinner.change_hold_type('hold')
     } else {
       document.querySelector('#top_hold_btn').classList.add("pinning-selected-button");
       holds_pinner.change_hold_type('top')
     }
   }

   function increase_hold_size() {
     holds_pinner.increase_size();
   }

   function decrease_hold_size() {
     holds_pinner.decrease_size();
   }

   function undo() {
     holds_pinner.undo();
   }

   function save_holds() {
     var result = {};
     result['holds'] = holds_pinner.get_holds();
     result['image'] = holds_pinner.export_image();
     alert(JSON.stringify(result['holds']));
   }
</script>
  </body>
</html>

